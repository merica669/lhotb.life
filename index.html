<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last House On The Block</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Raleway:wght@300;400;600&display=swap');
       
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
       
        body {
            font-family: 'Raleway', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            color: #f4e8d0;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
       
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(90deg, rgba(212,175,55,0.03) 0px, transparent 2px, transparent 40px),
                repeating-linear-gradient(0deg, rgba(212,175,55,0.03) 0px, transparent 2px, transparent 40px);
            pointer-events: none;
            z-index: 0;
        }
       
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
       
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(18,18,35,0.8));
            border: 3px solid #d4af37;
            border-radius: 5px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(212,175,55,0.3);
            position: relative;
        }
       
        header::before,
        header::after {
            content: '';
            position: absolute;
            background: #d4af37;
        }
       
        header::before {
            top: 10px;
            left: 10px;
            right: 10px;
            height: 1px;
        }
       
        header::after {
            bottom: 10px;
            left: 10px;
            right: 10px;
            height: 1px;
        }
       
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.5em;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(135deg, #d4af37, #f4e8d0, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
        }
       
        header p {
            font-size: 1.1em;
            color: #d4af37;
            font-style: italic;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
       
        .ornament {
            color: #d4af37;
            font-size: 2em;
            margin: 10px 0;
        }
       
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
       
        .stat-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(18,18,35,0.9));
            padding: 25px;
            border: 2px solid #d4af37;
            border-radius: 3px;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }
       
        .stat-card::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid rgba(212,175,55,0.3);
            pointer-events: none;
        }
       
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(212,175,55,0.4);
        }
       
        .stat-number {
            font-family: 'Playfair Display', serif;
            font-size: 3em;
            font-weight: 900;
            color: #d4af37;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
       
        .stat-label {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 10px;
            color: #c4af87;
        }
       
        .progress-section {
            background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(18,18,35,0.9));
            padding: 30px;
            border: 2px solid #d4af37;
            border-radius: 3px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
       
        .progress-section h3 {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
        }
       
        .progress-bar {
            background: rgba(0,0,0,0.5);
            height: 40px;
            border: 2px solid #d4af37;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }
       
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(212,175,55,0.5);
        }
       
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b6914, #d4af37, #f4e8d0);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #0f0c29;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
            box-shadow: inset 0 1px 20px rgba(255,255,255,0.3);
        }
       
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
       
        .tab-btn {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(18,18,35,0.9));
            border: 2px solid #d4af37;
            padding: 15px 35px;
            border-radius: 3px;
            color: #f4e8d0;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
       
        .tab-btn::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid rgba(212,175,55,0.3);
            transition: all 0.3s;
        }
       
        .tab-btn:hover {
            background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.3));
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212,175,55,0.3);
        }
       
        .tab-btn.active {
            background: linear-gradient(135deg, #d4af37, #c9a961);
            color: #0f0c29;
            font-weight: 700;
        }
       
        .tab-btn.active::before {
            border-color: #f4e8d0;
        }
       
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
       
        .item-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(18,18,35,0.9));
            padding: 25px;
            border: 2px solid #8b7355;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-shadow: 0 3px 15px rgba(0,0,0,0.5);
        }
       
        .item-card::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid rgba(139,115,85,0.3);
            pointer-events: none;
        }
       
        .item-card:hover {
            transform: translateY(-5px);
            border-color: #d4af37;
            box-shadow: 0 8px 30px rgba(212,175,55,0.4);
        }
       
        .item-card.completed {
            border-color: #d4af37;
            background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(139,105,20,0.2));
        }
       
        .item-card.completed::before {
            border-color: rgba(212,175,55,0.5);
        }
       
        .item-card.completed::after {
            content: "âœ“";
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: #d4af37;
            border: 2px solid #f4e8d0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            color: #0f0c29;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(0,0,0,0.5);
        }
       
        .item-number {
            font-family: 'Playfair Display', serif;
            font-size: 2.2em;
            font-weight: 900;
            color: #d4af37;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
       
        .item-card .item-text {
            font-size: 0.95em;
            line-height: 1.6;
            color: #e8d9c5;
        }
       
        .chat-container {
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(18,18,35,0.95));
            border: 3px solid #d4af37;
            border-radius: 3px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            position: relative;
        }
       
        .chat-container::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid rgba(212,175,55,0.3);
            pointer-events: none;
        }
       
        .chat-container h2 {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            font-size: 2em;
            margin-bottom: 25px;
            text-align: center;
            letter-spacing: 2px;
        }
       
        .chat-output {
            background: rgba(0,0,0,0.6);
            height: 450px;
            overflow-y: auto;
            padding: 25px;
            border: 2px solid #8b7355;
            border-radius: 3px;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }
       
        .chat-output::-webkit-scrollbar {
            width: 10px;
        }
       
        .chat-output::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
        }
       
        .chat-output::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 5px;
        }
       
        .message {
            margin: 15px 0;
            padding: 18px;
            border-radius: 3px;
            animation: slideIn 0.4s ease;
            border: 1px solid transparent;
        }
       
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
       
        .message.user {
            background: linear-gradient(135deg, rgba(139,105,20,0.4), rgba(139,105,20,0.6));
            margin-left: 15%;
            border-color: #8b6914;
            border-left: 4px solid #d4af37;
        }
       
        .message.bot {
            background: linear-gradient(135deg, rgba(18,18,35,0.6), rgba(48,43,99,0.6));
            margin-right: 15%;
            border-color: #8b7355;
            border-left: 4px solid #c4af87;
        }
       
        .message.system {
            background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.3));
            text-align: center;
            font-weight: 600;
            font-style: italic;
            border-color: #d4af37;
            color: #d4af37;
        }
       
        .chat-input-area {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
       
        .chat-input {
            flex: 1;
            padding: 18px;
            border-radius: 3px;
            border: 2px solid #8b7355;
            background: rgba(0,0,0,0.5);
            color: #f4e8d0;
            font-size: 1em;
            font-family: 'Raleway', sans-serif;
            transition: all 0.3s;
        }
       
        .chat-input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 15px rgba(212,175,55,0.3);
        }
       
        .chat-input::placeholder {
            color: rgba(244,232,208,0.4);
            font-style: italic;
        }
       
        .send-btn {
            padding: 18px 40px;
            background: linear-gradient(135deg, #8b6914, #d4af37);
            border: 2px solid #f4e8d0;
            border-radius: 3px;
            color: #0f0c29;
            cursor: pointer;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
            position: relative;
        }
       
        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(212,175,55,0.5);
            background: linear-gradient(135deg, #d4af37, #f4e8d0);
        }
       
        .send-btn:active {
            transform: scale(0.98);
        }
       
        .achievement-popup {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, #d4af37, #f4e8d0);
            color: #0f0c29;
            padding: 25px 30px;
            border: 3px solid #8b6914;
            border-radius: 3px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            animation: popIn 0.6s ease;
            max-width: 350px;
            z-index: 1000;
            position: relative;
        }
       
        .achievement-popup::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid #8b6914;
        }
       
        @keyframes popIn {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
       
        .achievement-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            font-weight: 900;
            margin-bottom: 10px;
        }
       
        .chalkboard {
            background: #1a1a1a;
            padding: 25px;
            border: 3px solid #d4af37;
            border-radius: 3px;
            margin-top: 25px;
            min-height: 180px;
            font-family: 'Courier New', monospace;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.8);
        }
       
        .chalkboard-title {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.4em;
            letter-spacing: 2px;
            text-align: center;
        }
       
        .chalkboard-entry {
            color: #f4e8d0;
            padding: 12px;
            margin: 8px 0;
            border-left: 3px solid #d4af37;
            padding-left: 20px;
            background: rgba(212,175,55,0.05);
        }
       
        .pro-mode {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border: 2px solid #8b7355;
            border-radius: 3px;
            margin-top: 20px;
        }
       
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            font-size: 1.05em;
        }
       
        input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }
       
        input[type="password"] {
            width: 100%;
            padding: 12px;
            border-radius: 3px;
            border: 2px solid #8b7355;
            background: rgba(0,0,0,0.5);
            color: #f4e8d0;
            font-family: 'Raleway', sans-serif;
            transition: all 0.3s;
        }
       
        input[type="password"]:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 15px rgba(212,175,55,0.3);
        }
       
        .hidden {
            display: none;
        }
       
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
           
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
           
            .tab-btn {
                padding: 12px 20px;
                font-size: 0.95em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="ornament">â—†â—†â—†</div>
            <h1>LAST HOUSE ON THE BLOCK</h1>
            <div class="ornament">â—†</div>
            <p>A Gentleman's Guide to Recovery</p>
            <div class="ornament">â—†â—†â—†</div>
        </header>
       
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-number" id="total-points">0</div>
                <div class="stat-label">Points</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="streak">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="level">1</div>
                <div class="stat-label">Level</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completed">0/74</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>
       
        <div class="progress-section">
            <h3>Journey Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
            </div>
        </div>
       
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('steps')">The 12 Steps</button>
            <button class="tab-btn" onclick="switchTab('traditions')">The 12 Traditions</button>
            <button class="tab-btn" onclick="switchTab('adages')">Adages of Wisdom</button>
        </div>
       
        <div id="steps-content" class="content-grid"></div>
        <div id="traditions-content" class="content-grid hidden"></div>
        <div id="adages-content" class="content-grid hidden"></div>
       
        <div class="chat-container">
            <h2>Parlor with Bill</h2>
            <div class="chat-output" id="chat-output"></div>
            <div class="chat-input-area">
                <input class="chat-input" id="chat-input" type="text" placeholder="Share your thoughts with Bill...">
                <button class="send-btn" onclick="sendMessage()">Send</button>
            </div>
            <div class="pro-mode">
                <label class="checkbox-label">
                    <input type="checkbox" id="pro-mode">
                    <span>Enable Pro Mode (AI-Powered Responses)</span>
                </label>
                <input id="api-key" type="password" placeholder="Enter xAI API Key (visit x.ai/api)">
            </div>
            <div class="chalkboard">
                <div class="chalkboard-title">Your Personal Reflections</div>
                <div id="chalkboard-content"></div>
            </div>
        </div>
    </div>
   
    <script>
        const steps = [
            'We admitted we were powerless over alcohol â€” that our lives had become unmanageable.',
            'Came to believe that a Power greater than ourselves could restore us to sanity.',
            'Made a decision to turn our will and our lives over to the care of God as we understood Him.',
            'Made a searching and fearless moral inventory of ourselves.',
            'Admitted to God, to ourselves, and to another human being the exact nature of our wrongs.',
            'Were entirely ready to have God remove all these defects of character.',
            'Humbly asked Him to remove our shortcomings.',
            'Made a list of all persons we had harmed, and became willing to make amends to them all.',
            'Made direct amends to such people wherever possible, except when to do so would injure them or others.',
            'Continued to take personal inventory and when we were wrong promptly admitted it.',
            'Sought through prayer and meditation to improve our conscious contact with God as we understood Him, praying only for knowledge of His will for us and the power to carry that out.',
            'Having had a spiritual awakening as the result of these Steps, we tried to carry this message to alcoholics, and to practice these principles in all our affairs.'
        ];
       
        const traditions = [
            'Our common welfare should come first; personal recovery depends upon A.A. unity.',
            'For our group purpose there is but one ultimate authority â€” a loving God as He may express Himself in our group conscience. Our leaders are but trusted servants; they do not govern.',
            'The only requirement for A.A. membership is a desire to stop drinking.',
            'Each group should be autonomous except in matters affecting other groups or A.A. as a whole.',
            'Each group has but one primary purpose â€” to carry its message to the alcoholic who still suffers.',
            'An A.A. group ought never endorse, finance, or lend the A.A. name to any related facility or outside enterprise, lest problems of money, property, and prestige divert us from our primary purpose.',
            'Every A.A. group ought to be fully self-supporting, declining outside contributions.',
            'Alcoholics Anonymous should remain forever non-professional, but our service centers may employ special workers.',
            'A.A., as such, ought never be organized; but we may create service boards or committees directly responsible to those they serve.',
            'Alcoholics Anonymous has no opinion on outside issues; hence the A.A. name ought never be drawn into public controversy.',
            'Our public relations policy is based on attraction rather than promotion; we need always maintain personal anonymity at the level of press, radio, and films.',
            'Anonymity is the spiritual foundation of all our traditions, ever reminding us to place principles before personalities.'
        ];
       
        const adages = [
            'easy does it', 'first things first', 'live and let live', 'but for the grace of God',
            'think ... think ... think ...', 'one day at time', 'let go and let God', 'kiss: keep it simple stupid',
            'act as if ....', 'this too shall pass', 'expect miracles', 'i can\'t .... he can .... i think i\'ll let him',
            'if it works .... don\'t fix it', 'keep coming back .... it works if you work it', 'stick with the winners',
            'keep right size', 'sobriety is a journey .... not a destination', 'faith without works is dead',
            'poor me... poor me... pour me another drink', 'to thine own self be true', 'I came; I came to; I came to believe',
            'live in the NOW', 'if God seems far away, who moved ?', 'turn it over', 'AA = altered attitudes',
            'nothing is so bad, a drink won\'t make it worse', 'we are only as sick as our secrets', 'there are no coincidences in AA',
            'be part of the solution,not the problem', 'sponsors: have one ... use one ... be one', 'I can\'t handle it God; you take over',
            'keep an open mind', 'it works ... it really does !', 'willingness is the key', 'more will be revealed',
            'you will intuitively know', 'you will be amazed', 'no pain .... no gain', 'go for it',
            'keep the plug in the jug', 'do it sober', 'let it begin with me', 'just for today',
            'sober \'n\' crazy', 'pass it on', 'it\'s in the book', 'you either is .... or you ain\'t',
            'before you say i can\'t .... say i\'ll try', 'don\'t quit 5 minutes before the miracle happens', 'some of us are sicker than others'
        ];
       
        const appendix = `
12 Steps:
1. ${steps[0]}
2. ${steps[1]}
3. ${steps[2]}
4. ${steps[3]}
5. ${steps[4]}
6. ${steps[5]}
7. ${steps[6]}
8. ${steps[7]}
9. ${steps[8]}
10. ${steps[9]}
11. ${steps[10]}
12. ${steps[11]}

12 Traditions:
1. ${traditions[0]}
2. ${traditions[1]}
3. ${traditions[2]}
4. ${traditions[3]}
5. ${traditions[4]}
6. ${traditions[5]}
7. ${traditions[6]}
8. ${traditions[7]}
9. ${traditions[8]}
10. ${traditions[9]}
11. ${traditions[10]}
12. ${traditions[11]}

Adages:
${adages.join(', ')}.
`;

        const predefinedResponses = {
            'Step 1': {
                response: 'My dear friend, Step 1 is the cornerstone: We admit we are powerless over alcohol and that our lives have become unmanageable. This honest admission opens the door to healing.',
                followups: ['What does "powerless" truly entail?', 'How might one recognize an unmanageable life?', 'Shall we discuss moving to Step 2?']
            },
            'Step 2': {
                response: 'In Step 2, we come to believe that a Power greater than ourselves can restore us to sanity. It is a gentle invitation to hope and faith.',
                followups: ['How do you envision your Higher Power?', 'What steps can foster this belief?', 'Examples of restored sanity in others?']
            },
            'Step 3': {
                response: 'Step 3 involves making a decision to turn our will and lives over to the care of God as we understand Him. It is an act of profound surrender.',
                followups: ['How does one make this decision earnestly?', 'Understanding "God" in personal terms?', 'What does surrendering look like daily?']
            },
            'Step 4': {
                response: 'We make a searching and fearless moral inventory of ourselves in Step 4. This self-reflection, though challenging, brings clarity.',
                followups: ['Methods for conducting this inventory?', 'What aspects should be examined?', 'Overcoming fears in this process?']
            },
            'Step 5': {
                response: 'Step 5: Admitting to God, ourselves, and another the exact nature of our wrongs. Sharing lightens the burden and fosters connection.',
                followups: ['Choosing a trusted confidant?', 'The role of admission in healing?', 'Potential outcomes of this step?']
            },
            'Step 6': {
                response: 'In Step 6, we become entirely ready to have God remove these defects of character. Readiness is key to transformation.',
                followups: ['Identifying character defects?', 'Cultivating readiness?', 'Common obstacles encountered?']
            },
            'Step 7': {
                response: 'Step 7: Humbly asking Him to remove our shortcomings. This humble request invites divine assistance.',
                followups: ['The essence of humility here?', 'Formulating this request?', 'If shortcomings persist, what then?']
            },
            'Step 8': {
                response: 'We make a list of persons harmed and become willing to make amends in Step 8. Preparation for reconciliation.',
                followups: ['Compiling an honest list?', 'Building willingness?', 'Who belongs on this list?']
            },
            'Step 9': {
                response: 'Step 9: Making direct amends where possible, without causing further harm. Action brings freedom.',
                followups: ['Approaches to making amends?', 'When to refrain?', 'Illustrative examples?']
            },
            'Step 10': {
                response: 'Continued personal inventory and prompt admission of wrongs in Step 10. Maintenance for ongoing growth.',
                followups: ['Daily inventory practices?', 'Importance of promptness?', 'Useful tools for this?']
            },
            'Step 11': {
                response: 'Seeking through prayer and meditation to improve contact with God in Step 11. Nurturing the spirit.',
                followups: ['Distinguishing prayer and meditation?', 'Enhancing conscious contact?', 'Establishing a routine?']
            },
            'Step 12': {
                response: 'Having a spiritual awakening, we carry the message and practice these principles. Giving back completes the circle.',
                followups: ['Signs of spiritual awakening?', 'Carrying the message effectively?', 'Applying principles in all affairs?']
            },
            'Tradition 1': {
                response: 'Tradition 1: Our common welfare comes first; recovery depends on unity. Together, we thrive.',
                followups: ['The vital role of unity?', 'Safeguarding group welfare?', 'Instances of unity in action?']
            },
            'Tradition 2': {
                response: 'One ultimate authorityâ€”a loving God expressed in group conscience. Leaders serve, not rule.',
                followups: ['Understanding group conscience?', 'The servant-leader concept?', 'Avoiding governance?']
            },
            'Tradition 3': {
                response: 'Desire to stop drinking is the sole membership requirement. Inclusivity at its core.',
                followups: ['Rationale for thissimplicity?', 'No further qualifications?', 'Benefits to the fellowship?']
            },
            'Tradition 4': {
                response: 'Groups are autonomous except when affecting others or A.A. as a whole. Freedom with accountability.',
                followups: ['Defining group autonomy?', 'Matters affecting others?', 'Practical applications?']
            },
            'Tradition 5': {
                response: 'Primary purpose: Carry the message to suffering alcoholics. Focus remains paramount.',
                followups: ['The core message?', 'Methods of conveyance?', 'Steering clear of diversions?']
            },
            'Tradition 6': {
                response: 'No endorsements, financing, or lending the A.A. name. Purity of purpose preserved.',
                followups: ['Reasons against affiliations?', 'Dangers of money and prestige?', 'Historical context?']
            },
            'Tradition 7': {
                response: 'Fully self-supporting, declining outside contributions. Independence ensures integrity.',
                followups: ['Rejecting external aid?', 'Achieving self-support?', 'The seventh tradition basket?']
            },
            'Tradition 8': {
                response: 'Forever non-professional, though special workers may be employed. Service from the heart.',
                followups: ['Allowing special workers?', 'Non-professional ethos?', 'Service center operations?']
            },
            'Tradition 9': {
                response: 'A.A. not organized, but service boards permitted. Structure without hierarchy.',
                followups: ['Avoiding organization?', 'Role of service committees?', 'Accountability in service?']
            },
            'Tradition 10': {
                response: 'No opinions on outside issues; avoiding controversy. Neutrality protects the name.',
                followups: ['Identifying outside issues?', 'Staying opinion-free?', 'Preventing public disputes?']
            },
            'Tradition 11': {
                response: 'Attraction over promotion; anonymity in media. Humility in public relations.',
                followups: ['Attraction versus promotion?', 'Maintaining anonymity?', 'Media engagement levels?']
            },
            'Tradition 12': {
                response: 'Anonymity as spiritual foundation, principles before personalities. Ego in check.',
                followups: ['Spiritual significance of anonymity?', 'Prioritizing principles?', 'Daily application?']
            },
            default: {
                response: 'This piece of wisdom holds profound meaning in the recovery journey. Let us ponder its application together.',
                followups: ['How does this resonate with you?', 'Origins and history?', 'Connections to the Steps or Traditions?']
            }
        };
       
        let gameState = {
            points: 0,
            streak: 1,
            level: 1,
            completed: new Set(),
            lastVisit: new Date().toDateString()
        };
       
        const saved = localStorage.getItem('lastHouseJourney');
        if (saved) {
            const parsed = JSON.parse(saved);
            gameState = {
                ...parsed,
                completed: new Set(parsed.completed || [])
            };
            const today = new Date().toDateString();
            if (gameState.lastVisit !== today) {
                const lastDate = new Date(gameState.lastVisit);
                const todayDate = new Date(today);
                const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));
                if (diffDays === 1) {
                    gameState.streak++;
                } else if (diffDays > 1) {
                    gameState.streak = 1;
                }
                gameState.lastVisit = today;
                saveState();
            }
        }
       
        function saveState() {
            localStorage.setItem('lastHouseJourney', JSON.stringify({
                ...gameState,
                completed: Array.from(gameState.completed)
            }));
        }
       
        function updateStats() {
            document.getElementById('total-points').textContent = gameState.points;
            document.getElementById('streak').textContent = gameState.streak;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('completed').textContent = `${gameState.completed.size}/74`;
           
            const progress = Math.round((gameState.completed.size / 74) * 100);
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-fill').textContent = progress + '%';
           
            const newLevel = Math.floor(gameState.points / 100) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                showAchievement('Distinguished Achievement', `You have reached Level ${newLevel}`);
            }
        }
       
        function renderItems() {
            renderSteps();
            renderTraditions();
            renderAdages();
            updateStats();
        }
       
        function renderSteps() {
            const container = document.getElementById('steps-content');
            container.innerHTML = '';
            steps.forEach((step, i) => {
                const id = `step-${i}`;
                const completed = gameState.completed.has(id);
                const card = document.createElement('div');
                card.className = `item-card ${completed ? 'completed' : ''}`;
                card.innerHTML = `
                    <div class="item-number">Step ${i + 1}</div>
                    <div class="item-text">${step}</div>
                `;
                card.onclick = () => clickItem(id, `Step ${i + 1}: ${step}`, 10);
                container.appendChild(card);
            });
        }
       
        function renderTraditions() {
            const container = document.getElementById('traditions-content');
            container.innerHTML = '';
            traditions.forEach((tradition, i) => {
                const id = `tradition-${i}`;
                const completed = gameState.completed.has(id);
                const card = document.createElement('div');
                card.className = `item-card ${completed ? 'completed' : ''}`;
                card.innerHTML = `
                    <div class="item-number">Tradition ${i + 1}</div>
                    <div class="item-text">${tradition}</div>
                `;
                card.onclick = () => clickItem(id, `Tradition ${i + 1}: ${tradition}`, 10);
                container.appendChild(card);
            });
        }
       
        function renderAdages() {
            const container = document.getElementById('adages-content');
            container.innerHTML = '';
            adages.forEach((adage, i) => {
                const id = `adage-${i}`;
                const completed = gameState.completed.has(id);
                const card = document.createElement('div');
                card.className = `item-card ${completed ? 'completed' : ''}`;
                card.innerHTML = `
                    <div class="item-number">â—†</div>
                    <div class="item-text">${adage}</div>
                `;
                card.onclick = () => clickItem(id, adage, 5);
                container.appendChild(card);
            });
        }
       
        function clickItem(id, text, points) {
            const isNew = !gameState.completed.has(id);
            if (isNew) {
                gameState.completed.add(id);
                gameState.points += points;
                showAchievement('Discovery Made', `+${points} points earned`);
                saveState();
                updateStats();
                renderItems();
            }
            addMessage(`You have selected: ${text}`, 'system');
            handleResponse(text);
        }
       
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
           
            document.getElementById('steps-content').classList.add('hidden');
            document.getElementById('traditions-content').classList.add('hidden');
            document.getElementById('adages-content').classList.add('hidden');
            document.getElementById(`${tab}-content`).classList.remove('hidden');
        }
       
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (!msg) return;
           
            addMessage(msg, 'user');
            input.value = '';
           
            gameState.points += 2;
            updateStats();
            saveState();
           
            if (!msg.endsWith('?')) {
                addToChalkboard(msg);
                gameState.points += 3;
                updateStats();
                saveState();
            } else {
                handleResponse(msg);
            }
        }
       
        function handleResponse(query) {
            const proMode = document.getElementById('pro-mode').checked;
            const apiKey = document.getElementById('api-key').value.trim();
           
            if (proMode && apiKey) {
                callApi(query, apiKey);
            } else {
                setTimeout(() => {
                    const key = query.split(':')[0].trim();
                    const data = predefinedResponses[key] || predefinedResponses.default;
                    addMessage(data.response, 'bot');
                    addMessage(`Suggested follow-ups: ${data.followups.join(', ')}`, 'bot');
                   
                    gameState.points += 5;
                    updateStats();
                    saveState();
                }, 500);
            }
        }
       
        async function callApi(query, apiKey) {
            addMessage('Bill is contemplating...', 'bot');
            try {
                const response = await fetch('https://api.x.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'grok-beta',
                        messages: [
                            { role: 'system', content: 'You are Bill, a distinguished gentleman and wise guide in the tradition of 1920s recovery programs. Speak with warmth, dignity, and thoughtfulness. Provide branching follow-up questions like Perplexity. Use this appendix as context: ' + appendix },
                            { role: 'user', content: query }
                        ]
                    })
                });
                const data = await response.json();
                if (data.choices && data.choices[0]) {
                    const lastMsg = document.querySelector('.message.bot:last-child');
                    if (lastMsg) lastMsg.remove();
                    addMessage(data.choices[0].message.content, 'bot');
                }
            } catch (error) {
                addMessage(`My apologies, there seems to be a technical difficulty: ${error.message}`, 'bot');
            }
        }
       
        function addMessage(text, type) {
            const output = document.getElementById('chat-output');
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = text;
            output.appendChild(msg);
            output.scrollTop = output.scrollHeight;
        }
       
        function addToChalkboard(text) {
            const board = document.getElementById('chalkboard-content');
            const entry = document.createElement('div');
            entry.className = 'chalkboard-entry';
            entry.textContent = `â—† ${text}`;
            board.appendChild(entry);
        }
       
        function showAchievement(title, desc) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-title">${title}</div>
                <div>${desc}</div>
            `;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
        }
       
        renderItems();
        addMessage('Welcome to the Last House on the Block. I am Bill, your guide on this journey of recovery. Feel free to explore the Steps, Traditions, and Adages at your leisure.', 'bot');
       
        let completedSteps = 0, completedTraditions = 0, completedAdages = 0;
        gameState.completed.forEach(id => {
            if (id.startsWith('step-')) completedSteps++;
            else if (id.startsWith('tradition-')) completedTraditions++;
            else if (id.startsWith('adage-')) completedAdages++;
        });
        if (completedSteps === 12) {
            showAchievement('Milestone Achieved', 'All 12 Steps Completed');
        }
        if (completedTraditions === 12) {
            showAchievement('Milestone Achieved', 'All 12 Traditions Completed');
        }
        if (completedAdages === 50) {
            showAchievement('Milestone Achieved', 'All Adages of Wisdom Completed');
        }
        if (gameState.completed.size === 74) {
            showAchievement('Journey Complete', 'You have explored all wisdom contained herein');
        }
       
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
